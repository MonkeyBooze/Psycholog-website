{% extends 'base.html' %}
{% load static %}

{% block title %}Blog psychologiczny - {{ SITE_NAME }}{% endblock %}
{% block description %}Przeczytaj nasze artykuły o zdrowiu psychicznym, terapii i rozwoju osobistym. Profesjonalne porady psychologiczne w Opolu.{% endblock %}

{% block head_extra %}
<meta property="og:title" content="Blog psychologiczny - {{ SITE_NAME }}">
<meta property="og:description" content="Przeczytaj nasze artykuły o zdrowiu psychicznym, terapii i rozwoju osobistym.">
<meta property="og:type" content="website">
<link rel="canonical" href="{{ request.build_absolute_uri }}">
{% endblock %}

{% block content %}
<!-- Hero Section -->
<section class="blog-hero section-small">
  <div class="container">
    <div class="hero-content text-center">
      <h1>Blog psychologiczny</h1>
      <p class="hero-subtitle">Artykuły o zdrowiu psychicznym, terapii i rozwoju osobistym</p>
    </div>
  </div>
</section>

<!-- Blog Content -->
<section class="blog-content section bg-light">
  <div class="container">
    <div class="blog-layout">
      
      <!-- Sidebar -->
      <aside class="blog-sidebar">
        <!-- Search Form -->
        <div class="sidebar-widget">
          <h3>Wyszukaj artykuły</h3>
          <form method="get" class="blog-search-form">
            <div class="search-input-container">
              <input type="text" name="q" placeholder="Szukaj artykułów..." value="{{ search_query }}" class="search-input">
            </div>
            <button type="submit" class="search-btn" title="Szukaj">
              <svg width="18" height="18" fill="currentColor" viewBox="0 0 24 24">
                <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
              </svg>
              <span class="search-btn-text">Szukaj</span>
            </button>
          </form>
        </div>
        
        <!-- Categories -->
        <div class="sidebar-widget">
          <h3>Kategorie</h3>
          <ul class="category-list">
            <li><a href="{% url 'blog' %}" {% if not selected_category %}class="active"{% endif %}>Wszystkie</a></li>
            {% for category in categories %}
            <li>
              <a href="?category={{ category.slug }}" {% if selected_category.slug == category.slug %}class="active"{% endif %}>
                {{ category.name }}
              </a>
            </li>
            {% endfor %}
          </ul>
        </div>
        
        <!-- Contact CTA -->
        <div class="sidebar-widget cta-widget">
          <h3>Potrzebujesz pomocy?</h3>
          <p>Umów konsultację z doświadczonym psychologiem</p>
          <a href="{% url 'contact' %}" class="btn btn-primary btn-small">Umów wizytę</a>
        </div>
      </aside>
      
      <!-- Main Content -->
      <main class="blog-main">
        
        {% if selected_category %}
        <div class="category-header">
          <h2>Kategoria: {{ selected_category.name }}</h2>
          {% if selected_category.description %}
          <p>{{ selected_category.description }}</p>
          {% endif %}
        </div>
        {% endif %}
        
        {% if search_query %}
        <div class="search-results-header">
          <h2>Wyniki wyszukiwania dla: "{{ search_query }}"</h2>
          <p>Znaleziono {{ total_posts }} artykułów</p>
        </div>
        {% endif %}
        
        {% if page_obj %}
        <div class="blog-grid">
          {% for post in page_obj %}
          <article class="blog-card">
            {% if post.featured_image %}
            <div class="blog-card-image">
              <img src="{{ post.featured_image }}" alt="{{ post.title }}" loading="lazy">
            </div>
            {% endif %}
            
            <div class="blog-card-content">
              {% if post.category %}
              <div class="blog-meta">
                <a href="{% url 'blog_category' post.category.slug %}" class="category-badge">{{ post.category.name }}</a>
              </div>
              {% endif %}
              
              <h3><a href="{{ post.get_absolute_url }}">{{ post.title }}</a></h3>
              <p class="blog-excerpt">{{ post.excerpt }}</p>
              
              <div class="blog-footer">
                <div class="blog-meta-info">
                  <time datetime="{{ post.published_at|date:'c' }}">{{ post.published_at|date:'d.m.Y' }}</time>
                  <span class="read-time">{{ post.read_time }} min czytania</span>
                </div>
                <a href="{{ post.get_absolute_url }}" class="read-more">Czytaj więcej</a>
              </div>
            </div>
          </article>
          {% endfor %}
        </div>
        
        <!-- Pagination -->
        {% if page_obj.has_other_pages %}
        <nav class="pagination-nav">
          <ul class="pagination">
            {% if page_obj.has_previous %}
            <li><a href="?page={{ page_obj.previous_page_number }}{% if search_query %}&q={{ search_query }}{% endif %}{% if selected_category %}&category={{ selected_category.slug }}{% endif %}">&laquo; Poprzednia</a></li>
            {% endif %}
            
            {% for num in page_obj.paginator.page_range %}
            {% if page_obj.number == num %}
            <li class="active"><span>{{ num }}</span></li>
            {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
            <li><a href="?page={{ num }}{% if search_query %}&q={{ search_query }}{% endif %}{% if selected_category %}&category={{ selected_category.slug }}{% endif %}">{{ num }}</a></li>
            {% endif %}
            {% endfor %}
            
            {% if page_obj.has_next %}
            <li><a href="?page={{ page_obj.next_page_number }}{% if search_query %}&q={{ search_query }}{% endif %}{% if selected_category %}&category={{ selected_category.slug }}{% endif %}">Następna &raquo;</a></li>
            {% endif %}
          </ul>
        </nav>
        {% endif %}
        
        {% else %}
        <div class="no-posts">
          <h2>Brak artykułów</h2>
          <p>{% if search_query %}Nie znaleziono artykułów dla tego zapytania.{% else %}Wkrótce dodamy nowe artykuły.{% endif %}</p>
          {% if search_query %}
          <a href="{% url 'blog' %}" class="btn btn-secondary">Zobacz wszystkie artykuły</a>
          {% endif %}
        </div>
        {% endif %}
        
      </main>
    </div>
  </div>
</section>
{% endblock %}