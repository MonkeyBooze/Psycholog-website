{% extends 'base.html' %}
{% load static %}
{% load sanitize %}

{% block meta_title %}{{ post.title }} - {{ SITE_NAME }}{% endblock %}
{% block meta_description %}{{ post.meta_description|default:post.excerpt }}{% endblock %}
{% block og_type %}article{% endblock %}
{% block meta_image %}{% if post.featured_image %}{{ post.featured_image }}{% else %}{{ block.super }}{% endif %}{%
endblock %}

{% block head_extra %}
<meta property="article:published_time" content="{{ post.published_at|date:'c' }}">
<meta property="article:modified_time" content="{{ post.updated_at|date:'c' }}">
{% if post.category %}
<meta property="article:section" content="{{ post.category.name }}">
{% endif %}
{% if post.meta_keywords %}
<meta name="keywords" content="{{ post.meta_keywords }}">
{% endif %}


<!-- Structured Data for SEO -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Article",
  "headline": "{{ post.title|escapejs }}",
  "description": "{{ post.meta_description|default:post.excerpt|escapejs }}",
  {% if post.featured_image %}"image": "{{ post.featured_image }}",{% endif %}
  "datePublished": "{{ post.published_at|date:'c' }}",
  "dateModified": "{{ post.updated_at|date:'c' }}",
  "author": {
    "@type": "Organization",
    "name": "{{ SITE_NAME }}"
  },
  "publisher": {
    "@type": "Organization",
    "name": "{{ SITE_NAME }}"
  },
  {% if post.category %}"articleSection": "{{ post.category.name|escapejs }}",{% endif %}
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "{{ request.build_absolute_uri }}"
  }
}
</script>
{% endblock %}

{% block content %}
<!-- Article Header -->
<article class="blog-post">
  <header class="post-header section-small">
    <div class="container">
      <div class="post-header-content">

        <!-- Breadcrumbs -->
        <nav class="breadcrumbs">
          <a href="{% url 'home' %}">Strona główna</a>
          <span>/</span>
          <a href="{% url 'blog' %}">Blog</a>
          {% if post.category %}
          <span>/</span>
          <a href="{% url 'blog_category' post.category.slug %}">{{ post.category.name }}</a>
          {% endif %}
          <span>/</span>
          <span>{{ post.title }}</span>
        </nav>

        {% if post.category %}
        <div class="post-category">
          <a href="{% url 'blog_category' post.category.slug %}" class="category-badge">{{ post.category.name }}</a>
        </div>
        {% endif %}

        <h1>{{ post.title }}</h1>

        <div class="post-meta">
          <time datetime="{{ post.published_at|date:'c' }}">{{ post.published_at|date:'d F Y' }}</time>
          <span class="meta-separator">•</span>
          <span class="read-time">{{ post.read_time }} min czytania</span>
          <span class="meta-separator">•</span>
          <span class="view-count">{{ post.views_count }} wyświetleń</span>
        </div>

        {% if post.excerpt %}
        <p class="post-excerpt">{{ post.excerpt }}</p>
        {% endif %}
      </div>
    </div>
  </header>

  <!-- Featured Image -->
  {% if post.featured_image %}
  <div class="post-featured-image">
    <div class="container">
      <img src="{{ post.featured_image }}" alt="{{ post.title }}" class="featured-img">
    </div>
  </div>
  {% endif %}

  <!-- Article Content -->
  <div class="post-content section bg-light">
    <div class="container">
      <div class="post-layout">

        <!-- Main Content -->
        <main class="post-main">
          <div class="post-body">
            {{ post.content|sanitize_html }}
          </div>

          <!-- Article Footer -->
          <footer class="post-footer">

            <!-- Share Buttons -->
            <div class="post-share">
              <h4>Udostępnij artykuł:</h4>
              <div class="share-buttons">
                <a href="https://www.facebook.com/sharer/sharer.php?u={{ request.build_absolute_uri|urlencode }}"
                  target="_blank" class="share-btn facebook">
                  Facebook
                </a>
                <a href="https://twitter.com/intent/tweet?url={{ request.build_absolute_uri|urlencode }}&text={{ post.title|urlencode }}"
                  target="_blank" class="share-btn twitter">
                  Twitter
                </a>
                <a href="https://www.linkedin.com/sharing/share-offsite/?url={{ request.build_absolute_uri|urlencode }}"
                  target="_blank" class="share-btn linkedin">
                  LinkedIn
                </a>
                <button onclick="copyToClipboard('{{ request.build_absolute_uri }}')" class="share-btn copy-link">
                  Kopiuj link
                </button>
              </div>
            </div>

            <!-- Contact CTA -->
            <div class="post-cta">
              <div class="cta-content">
                <h3>Potrzebujesz profesjonalnej pomocy?</h3>
                <p>Skontaktuj się z nami, aby umówić konsultację psychologiczną.</p>
                <div class="cta-buttons">
                  <a href="{% url 'contact' %}" class="btn btn-primary">Umów wizytę</a>
                  <a href="tel:+48606841722" class="btn btn-secondary">Zadzwoń teraz</a>
                </div>
              </div>
            </div>

          </footer>
        </main>

        <!-- Sidebar -->
        <aside class="post-sidebar">

          {% if related_posts %}
          <!-- Related Posts -->
          <div class="sidebar-widget">
            <h3>Podobne artykuły</h3>
            <div class="related-posts">
              {% for related in related_posts %}
              <article class="related-post">
                {% if related.featured_image %}
                <div class="related-post-image">
                  <img src="{{ related.featured_image }}" alt="{{ related.title }}" loading="lazy">
                </div>
                {% endif %}
                <div class="related-post-content">
                  <h4><a href="{{ related.get_absolute_url }}">{{ related.title }}</a></h4>
                  <time datetime="{{ related.published_at|date:'c' }}">{{ related.published_at|date:'d.m.Y' }}</time>
                </div>
              </article>
              {% endfor %}
            </div>
          </div>
          {% endif %}

          {% if recent_posts %}
          <!-- Recent Posts -->
          <div class="sidebar-widget">
            <h3>Najnowsze artykuły</h3>
            <div class="recent-posts">
              {% for recent in recent_posts %}
              <article class="recent-post">
                <h4><a href="{{ recent.get_absolute_url }}">{{ recent.title }}</a></h4>
                <time datetime="{{ recent.published_at|date:'c' }}">{{ recent.published_at|date:'d.m.Y' }}</time>
              </article>
              {% endfor %}
            </div>
          </div>
          {% endif %}

          <!-- Contact Widget -->
          <div class="sidebar-widget contact-widget">
            <h3>Kontakt</h3>
            <div class="contact-info">
              <p><strong>Telefon:</strong><br><a href="tel:+48606841722">+48 606 841 722</a></p>
              <p><strong>Lokalizacja:</strong><br>Opole, Nysa</p>
              <a href="{% url 'contact' %}" class="btn btn-primary btn-small">Umów konsultację</a>
            </div>
          </div>

        </aside>
      </div>
    </div>
  </div>
</article>

<script>
  function copyToClipboard(text) {
    navigator.clipboard.writeText(text).then(function () {
      alert('Link został skopiowany do schowka!');
    });
  }
</script>
{% endblock %}